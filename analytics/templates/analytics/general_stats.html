{% extends "analytics/base.html" %}

{% block title %}Общая статистика - {{ config.site_title }}{% endblock %}

{% block content %}
<div class="container">
    <!-- Page Header -->
    <div class="row mb-4">
        <div class="col-12">
            <h1 class="display-5 fw-bold">
                <i class="fas fa-chart-bar text-primary me-3"></i>
                Общая статистика рынка
            </h1>
            <p class="lead text-muted">
                Комплексный обзор трендов и статистики IT-рынка
            </p>
        </div>
    </div>

    <!-- Salary Dynamics -->
    <div class="row mb-5">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title mb-0">
                        <i class="fas fa-ruble-sign text-success me-2"></i>
                        Динамика уровня зарплат по годам
                    </h3>
                    <p class="text-muted mb-0 mt-2">Средняя зарплата по всем IT-вакансиям (в рублях)</p>
                </div>
                <div class="card-body">
                    {% if stats_data.salary_dynamics %}
                        {% if stats_data.salary_dynamics.chart_image %}
                            <div class="text-center mb-3">
                                <img src="{{ stats_data.salary_dynamics.chart_image.url }}"
                                     alt="Динамика зарплат"
                                     class="img-fluid"
                                     style="max-height: 400px;">
                            </div>
                        {% endif %}
                        {% if stats_data.salary_dynamics.table_html %}
                            <div class="table-responsive">
                                {{ stats_data.salary_dynamics.table_html|safe }}
                            </div>
                        {% endif %}
                    {% else %}
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>
                            Данные по динамике зарплат будут загружены через админ-панель после обработки CSV файла.
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Vacancy Count Dynamics -->
    <div class="row mb-5">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title mb-0">
                        <i class="fas fa-chart-line text-info me-2"></i>
                        Динамика количества вакансий по годам
                    </h3>
                    <p class="text-muted mb-0 mt-2">Общее количество размещенных IT-вакансий</p>
                </div>
                <div class="card-body">
                    {% if stats_data.vacancy_count %}
                        {% if stats_data.vacancy_count.chart_image %}
                            <div class="text-center mb-3">
                                <img src="{{ stats_data.vacancy_count.chart_image.url }}"
                                     alt="Динамика вакансий"
                                     class="img-fluid"
                                     style="max-height: 400px;">
                            </div>
                        {% endif %}
                        {% if stats_data.vacancy_count.table_html %}
                            <div class="table-responsive">
                                {{ stats_data.vacancy_count.table_html|safe }}
                            </div>
                        {% endif %}
                    {% else %}
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>
                            Данные по количеству вакансий будут загружены через админ-панель.
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- City-based Statistics -->
    <div class="row mb-5">
        <div class="col-md-6">
            <div class="card h-100">
                <div class="card-header">
                    <h3 class="card-title mb-0">
                        <i class="fas fa-map-marker-alt text-warning me-2"></i>
                        Уровень зарплат по городам
                    </h3>
                    <p class="text-muted mb-0 mt-2">Топ городов по средней зарплате</p>
                </div>
                <div class="card-body">
                    {% if stats_data.salary_by_city %}
                        {% if stats_data.salary_by_city.chart_image %}
                            <div class="text-center mb-3">
                                <img src="{{ stats_data.salary_by_city.chart_image.url }}"
                                     alt="Зарплаты по городам"
                                     class="img-fluid"
                                     style="max-height: 300px;">
                            </div>
                        {% endif %}
                        {% if stats_data.salary_by_city.table_html %}
                            <div class="table-responsive">
                                {{ stats_data.salary_by_city.table_html|safe }}
                            </div>
                        {% endif %}
                    {% else %}
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>
                            Данные будут загружены через админ-панель.
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card h-100">
                <div class="card-header">
                    <h3 class="card-title mb-0">
                        <i class="fas fa-building text-danger me-2"></i>
                        Распределение вакансий по городам
                    </h3>
                    <p class="text-muted mb-0 mt-2">Топ городов по количеству вакансий</p>
                </div>
                <div class="card-body">
                    {% if stats_data.vacancy_by_city %}
                        {% if stats_data.vacancy_by_city.chart_image %}
                            <div class="text-center mb-3">
                                <img src="{{ stats_data.vacancy_by_city.chart_image.url }}"
                                     alt="Вакансии по городам"
                                     class="img-fluid"
                                     style="max-height: 300px;">
                            </div>
                        {% endif %}
                        {% if stats_data.vacancy_by_city.table_html %}
                            <div class="table-responsive">
                                {{ stats_data.vacancy_by_city.table_html|safe }}
                            </div>
                        {% endif %}
                    {% else %}
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>
                            Данные будут загружены через админ-панель.
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Top Skills -->
    <div class="row mb-5">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title mb-0">
                        <i class="fas fa-cogs text-secondary me-2"></i>
                        ТОП-20 навыков по годам
                    </h3>
                    <p class="text-muted mb-0 mt-2">Наиболее часто упоминаемые навыки во всех IT-вакансиях</p>
                </div>
                <div class="card-body">
                    {% if stats_data.top_skills %}
                        {% if stats_data.top_skills.chart_image %}
                            <div class="text-center mb-3">
                                <img src="{{ stats_data.top_skills.chart_image.url }}"
                                     alt="Топ навыков"
                                     class="img-fluid"
                                     style="max-height: 400px;">
                            </div>
                        {% endif %}
                        {% if stats_data.top_skills.table_html %}
                            <div class="table-responsive">
                                {{ stats_data.top_skills.table_html|safe }}
                            </div>
                        {% endif %}
                    {% else %}
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>
                            Данные по навыкам будут загружены через админ-панель после анализа ключевых навыков из CSV.
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Data Management Info -->
    <div class="row">
        <div class="col-12">
            <div class="card bg-light border-0">
                <div class="card-body">
                    <h5 class="card-title text-dark">
                        <i class="fas fa-database text-primary me-2"></i>
                        Управление данными
                    </h5>
                    <div class="row text-dark">
                        <div class="col-md-6">
                            <ul class="list-unstyled">
                                <li class="mb-2">
                                    <i class="fas fa-upload text-success me-2"></i>
                                    Данные загружаются через Django админ-панель
                                </li>
                                <li class="mb-2">
                                    <i class="fas fa-chart-bar text-info me-2"></i>
                                    Графики сохраняются как изображения (PNG/SVG)
                                </li>
                                <li class="mb-2">
                                    <i class="fas fa-table text-warning me-2"></i>
                                    Таблицы хранятся в формате HTML
                                </li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <ul class="list-unstyled">
                                <li class="mb-2">
                                    <i class="fas fa-file-csv text-primary me-2"></i>
                                    Исходные данные обрабатываются из CSV файла
                                </li>
                                <li class="mb-2">
                                    <i class="fas fa-exchange-alt text-secondary me-2"></i>
                                    Конвертация валют по курсу ЦБ РФ
                                </li>
                                <li class="mb-2">
                                    <i class="fas fa-filter text-danger me-2"></i>
                                    Исключение зарплат свыше 10 млн рублей
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}